{% extends 'base.html' %}

{% block content %}
<div class="header">
    <h2>{{ title }}</h2>
    <a href="{{ url_for('create_' + entity_name.rstrip('s')) }}" class="btn">+ –î–æ–±–∞–≤–∏—Ç—å</a>
</div>

<table>
    <thead>
        <tr>
            {% for column in columns %}
                {% if not (entity_name == 'concerts' and column == 'remaining_tickets') %}
                    <th>{{ column }}</th>
                {% endif %}
            {% endfor %}
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            {% if entity_name == 'concerts' %}
                <th>–û—Å—Ç–∞–ª–æ—Å—å –±–∏–ª–µ—Ç–æ–≤</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
    {% for row in rows %}
    <tr>
        {% for i in range(columns | length) %}
            {% set column = columns[i] %}
            {% if not (entity_name == 'concerts' and column == 'remaining_tickets') %}
            <td>
                {% set value = row[i] %}
                {% if i == 0 %}
                    {{ value }}
                {% elif value is none %}
                -
                {% elif column == 'photo' and value %}
                    <img src="data:image/jpeg;base64,{{ value | b64encode }}" alt="–§–æ—Ç–æ" class="thumbnail" style="height: 50px;">
                {% elif column == 'is_sold' %}
                    {% if value %}
                        <span class="badge bg-success">‚úÖ –ü—Ä–æ–¥–∞–Ω–æ</span>
                    {% else %}
                        <span class="badge bg-secondary">‚ùå –ù–µ –ø—Ä–æ–¥–∞–Ω–æ</span>
                    {% endif %}
                {% elif column == 'date' or column.endswith('_date') %}
                    {{ value.strftime('%d.%m.%Y %H:%M') if value else '' }}
                {% elif column in ['start_date', 'end_date'] %}
                    {{ value.strftime('%d.%m.%Y') if value else '' }}
                {% elif column in ['price', 'ticket_price'] %}
                    {{ "{:,.2f} —Ä—É–±.".format(value) }}
                {% else %}
                {{ value }}
                {% endif %}
            </td>

            {% endif %}
{% endfor %}
        <td class="actions">
            <a href="{{ url_for('edit_' + entity_name.rstrip('s'), id=row[0]) }}" class="btn btn-edit">‚úèÔ∏è</a>
            <a href="{{ url_for('delete_' + entity_name.rstrip('s'), id=row[0]) }}" 
               class="btn btn-delete" 
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')">üóëÔ∏è</a>
        </td>
        {% if entity_name == 'concerts' %}
    <td>
        {% set remaining = row[columns.index('remaining_tickets')] %}
        {% if remaining > 5 %}
            <span class="ticket-available">‚úÖ {{ remaining }}</span>
        {% elif remaining > 0 %}
            <span class="ticket-warning">‚ö†Ô∏è {{ remaining }}</span>
        {% else %}
            <span class="ticket-soldout">‚ùå –ù–µ—Ç –±–∏–ª–µ—Ç–æ–≤</span>
        {% endif %}
    </td>
{% endif %}
    </tr>
    {% endfor %}
</tbody>
</table>
{% endblock %}